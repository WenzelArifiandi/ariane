---
import Base from '../../layouts/Base.astro'
import { client } from '../../lib/sanity'
import { allProjects } from '../../lib/queries'
import { urlFor } from '../../lib/sanity'
import type { SanityProject } from '../../lib/types'

let projects: SanityProject[] = []
try { projects = await client.fetch(allProjects) } catch { projects = [] }
const page = { title: 'Work â€” Ariane', description: 'Selected projects' }
---

<Base title={page.title} description={page.description} pathname="/work">
  <h1 class="text-4xl font-semibold">Work</h1>
  {projects?.length ? (
    <ul class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {projects.map((p) => (
        <li class="rounded-xl border overflow-hidden hover:shadow-sm transition-shadow">
          <a href={`/work/${p.slug}`} class="block">
            {p.hero && (
              <img
                src={urlFor(p.hero).width(800).height(500).fit('crop').auto('format').url()}
                alt={p.hero.alt || p.title}
                class="aspect-[16/10] w-full object-cover"
                loading="lazy"
              />
            )}
            <div class="p-4">
              <h3 class="font-semibold">{p.title}</h3>
              {p.year && <p class="text-sm text-neutral-500 mt-1">{p.year}</p>}
              {p.summary && <p class="text-sm text-neutral-600 mt-2 line-clamp-2">{p.summary}</p>}
            </div>
          </a>
        </li>
      ))}
    </ul>
  ) : (
    <p class="mt-6 text-neutral-500">Publish some <code>Project</code> docs in Studio to populate this page.</p>
  )}
</Base>
