---
import { useStoryblokApi } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import Base from '../../layouts/Base.astro'
import '../../styles/global.css'

const { slug } = Astro.params
const storyblokApi = useStoryblokApi()

let story: any = null
let error: string | null = null

try {
  const { data } = await storyblokApi.get(`cdn/stories/work/${slug}`, { version: 'draft' })
  story = data?.story ?? null
} catch (e: any) {
  error = e?.message ?? 'Failed to load project'
}
---

<Base title={(story?.name ? `${story.name} — Ariane` : 'Project — Ariane')} description={story?.content?.summary ?? ''} pathname={`/work/${slug}`}>
  {story ? (
    <>
      <a href="/work" class="text-sm text-neutral-500 hover:underline">← Back to Work</a>
      <h1 class="mt-4 text-4xl font-semibold">{story.name}</h1>
      <StoryblokComponent blok={story.content} />
    </>
  ) : error ? (
    <p class="text-neutral-600">Project failed to load. <small>{error}</small> <a class="underline" href="/work">Back to Work</a></p>
  ) : (
    <p class="text-neutral-600">Loading project…</p>
  )}
</Base>
