---
import Base from '../layouts/Base.astro'
import Nav from '../components/Nav.astro'
import '../../styles/global.css'
import { client, urlFor } from '../lib/sanity'
import groq from 'groq'

// Sanity queries
const projects = await client.fetch(groq`
  *[_type == "project"] | order(featured desc, year desc, title asc)[]{
    _id, title, "slug": slug.current, year, summary, featured,
    hero{..., "alt": coalesce(alt, title)}
  }
`)

const about = await client.fetch(groq`
  *[_type == "about"][0]{
    bio, "headshotUrl": headshot.asset->url, skills
  }
`)

const links = await client.fetch(groq`
  *[_type == "link"] | order(pin desc, label asc){
    label, url, category, pin
  }
`)
---
<a id="top"></a>
<Base title="Ariane — Portfolio">
  <Nav />

  <!-- Hero -->
  <section data-section id="home" class="mx-auto max-w-6xl px-6 pt-14 pb-16">
    <h1 class="text-4xl md:text-6xl font-semibold tracking-tight">Ariane</h1>
    <p class="mt-4 text-lg text-neutral-600 max-w-2xl">
      Designerly, fast, and obsessively crafted. Built with Astro + Sanity + Vercel.
    </p>
  </section>

  <!-- Work -->
  <section data-section id="work" class="mx-auto max-w-6xl px-6 py-16 border-t border-neutral-200">
    <div class="flex items-end justify-between">
      <h2 class="text-2xl md:text-3xl font-semibold">Work</h2>
      <span class="text-sm text-neutral-500">{projects?.length ?? 0} projects</span>
    </div>

    <ul class="mt-8 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
      {projects?.map((p: any) => (
        <li class="group">
          <div class="block">
            {p.hero && (
              <img
                src={urlFor(p.hero).width(900).height(675).fit('crop').auto('format').url()}
                alt={p.hero.alt}
                loading="lazy"
                class="aspect-[4/3] w-full object-cover rounded-lg"
              />
            )}
            <div class="mt-3">
              <h3 class="text-lg font-medium group-hover:underline">{p.title}</h3>
              {p.year && <p class="text-sm text-neutral-500">{p.year}</p>}
              {p.summary && <p class="mt-2 text-sm text-neutral-600 line-clamp-3">{p.summary}</p>}
            </div>
          </div>
        </li>
      ))}
    </ul>
  </section>

  <!-- About -->
  <section data-section id="about" class="mx-auto max-w-6xl px-6 py-16 border-t border-neutral-200">
    <h2 class="text-2xl md:text-3xl font-semibold">About</h2>

    <div class="mt-6 grid gap-8 md:grid-cols-[160px,1fr] items-start">
      {about?.headshotUrl && (
        <img
          src={about.headshotUrl + '?w=600&h=600&fit=crop&auto=format'}
          alt="Headshot"
          class="w-40 h-40 rounded-full object-cover"
          loading="lazy"
        />
      )}

      <div class="prose prose-neutral max-w-none">
        {/* Render Portable Text quickly without an extra lib: simple fallback */}
        {about?.bio ? (
          about.bio.map((block: any) =>
            block._type === 'block' ? (
              <p>{block.children?.map((span: any) => span.text).join('')}</p>
            ) : null,
          )
        ) : (
          <p class="text-neutral-500">Fill your About doc in Studio to show your bio here.</p>
        )}
        {about?.skills?.length > 0 && (
          <ul class="not-prose mt-4 flex flex-wrap gap-2 text-sm text-neutral-700">
            {about.skills.map((s: string) => <li class="rounded-full border px-3 py-1">{s}</li>)}
          </ul>
        )}
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section data-section id="contact" class="mx-auto max-w-6xl px-6 py-16 border-t border-neutral-200">
    <h2 class="text-2xl md:text-3xl font-semibold">Contact</h2>
    <ul class="mt-6 grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
      {links?.map((l: any) => (
        <li>
          <a
            href={l.url}
            target="_blank"
            rel="noopener noreferrer"
            class="block rounded-lg border p-4 hover:border-neutral-400 transition-colors"
          >
            <div class="text-sm uppercase tracking-wide text-neutral-500">{l.category ?? 'Link'}</div>
            <div class="mt-1 font-medium">{l.label}</div>
          </a>
        </li>
      ))}
    </ul>
    <p class="mt-6 text-sm text-neutral-500">
      Prefer email? <a class="underline" href="mailto:hello@wenzelarifiandi.com">hello@wenzelarifiandi.com</a>
    </p>
  </section>

  <!-- Footer -->
  <footer class="mx-auto max-w-6xl px-6 py-12 border-t border-neutral-200 text-sm text-neutral-500">
    © {new Date().getFullYear()} Ariane
  </footer>
</Base>