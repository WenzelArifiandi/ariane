---
import { useStoryblokApi } from '@storyblok/astro'
import { getStoryblokVersion } from '../lib/storyblok/version'
import Hero from '../components/storyblok/Hero.astro'
import Project from '../components/storyblok/Project.astro'
import Base from '../layouts/Base.astro'
import Nav from '../components/Nav.astro'
import Footer from '../components/Footer.astro'

// Fetch content directly
const storyblokApi = useStoryblokApi()
let story = null

const version = getStoryblokVersion({ mode: import.meta.env.MODE, hasPreview: Astro.url.searchParams.has('_storyblok') })

try {
  const { data } = await storyblokApi.get('cdn/stories/home', { version })
  story = data?.story
} catch (error) {
  // Error handled silently in production
}
---

<Base title="Direct Test" description="Testing components directly">
  <Nav />

  {story?.content?.body ? (
    <main>
  {story.content.body.map((block: any) => {
        if (block.component === 'hero') {
          return <Hero blok={block} />
        }
        if (block.component === 'project') {
          return <Project blok={block} />
        }
        return <div>Unknown component: {block.component}</div>
      })}
    </main>
  ) : (
    <main style="padding: 2rem; text-align: center;">
      <h1>No content found</h1>
      <p>Check if story exists and has content.</p>
    </main>
  )}

  <Footer />
</Base>

<style>
  /* Enhanced background for glass effect */
  body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-attachment: fixed;
    min-height: 100vh;
  }
</style>