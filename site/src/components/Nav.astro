---
const links = [
  { href: '#hello', label: 'Hello' },
  { href: '#playground', label: 'Playground' },
  { href: '#field-notes', label: 'Field Notes' },
  { href: '#contact', label: 'Contact' },
  { href: import.meta.env.DEV ? 'http://localhost:4322/' : 'https://constellation.wenzelarifiandi.com', label: 'Constellation' },
];
const studioHref = import.meta.env.DEV ? 'http://localhost:3333/' : 'https://studio.wenzelarifiandi.com';
---

<nav class="sticky top-3 z-50 mx-auto my-3 px-3 sm:px-7">
  <div class="max-w-container mx-auto">
    <div class="glass-liquid flex items-center justify-between gap-nav md:gap-nav-md px-pad-x py-3 relative overflow-visible">

      <!-- Brand -->
      <a href="/" class="brand relative z-10 font-semibold text-[20px] leading-[23px]">Wenzel Arifiandi</a>

      <!-- Desktop links -->
      <ul class="hidden lg:flex items-center gap-nav lg:gap-nav-md font-medium text-[18px] leading-[21px] list-none m-0 p-0 relative z-10">
        {links.map(l => (
          <li class="whitespace-nowrap">
            <a class="nav-link" href={l.href}>{l.label}</a>
          </li>
        ))}
        <li class="whitespace-nowrap">
          <a class="nav-link" href={studioHref}>Studio</a>
        </li>
      </ul>

      <!-- Right: Explore (mobile) + Maker (always visible) -->
      <div class="flex items-center gap-2 relative z-10 flex-shrink-0">
        <!-- Explore button (mobile only, to the left of Maker) -->
        <button
          id="explore-toggle"
          class="lg:hidden chip-m3 inline-flex items-center gap-1.5 px-3 py-1.5
                 text-[18px] leading-[21px] font-medium
                 transition-[transform,box-shadow] duration-200 ease-[cubic-bezier(0.2,0,0,1)]
                 active:scale-[0.98] active:shadow-sm"
          aria-controls="mobile-menu"
          aria-expanded="false"
          aria-haspopup="true"
          type="button"
        >
          <!-- M3 compass icon -->
          <span class="material-symbols-rounded text-white" style="font-size: 16px;">explore</span>
          <span>Explore</span>
        </button>

        <!-- Maker button (always visible at all screen sizes) -->
        <button id="creator-toggle" class="chip-m3 inline-flex items-center gap-2 px-3 py-1.5 font-medium text-[18px] leading-[21px]"
                aria-haspopup="true" aria-expanded="false" aria-controls="creator-sheet" title="Maker">
          <!-- M3 sparkle icon -->
          <span class="material-symbols-rounded text-white" style="font-size: 18px;">auto_awesome</span>
          <span class="label hidden sm:inline whitespace-nowrap">Maker</span>
        </button>
      </div>

      <!-- Mobile drop panel -->
      <div id="mobile-menu"
           class="lg:hidden absolute left-0 right-0 top-full mt-2 px-3 sm:px-7"
           hidden>
        <div
          class="glass-liquid px-pad-x py-3
                 origin-top will-change-transform will-change-opacity
                 transition-[opacity,transform] duration-[420ms]
                 ease-[cubic-bezier(0.2,1.2,0.35,1)]
                 -translate-y-4 scale-[0.97]"
          data-anim
          aria-hidden="true"
          role="menu"
        >
          <ul class="py-2">
            <!-- Staggered menu items -->
            <li class="transition-opacity duration-300 delay-75 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href="#hello">
                <span class="material-symbols-rounded">waving_hand</span>
                <span>Hello</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-100 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href="#playground">
                <span class="material-symbols-rounded">science</span>
                <span>Playground</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-125 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href="#field-notes">
                <span class="material-symbols-rounded">edit_note</span>
                <span>Field Notes</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-150 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href="#contact">
                <span class="material-symbols-rounded">mail</span>
                <span>Contact</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-175 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href={import.meta.env.DEV ? 'http://localhost:4322/' : 'https://constellation.wenzelarifiandi.com'}>
                <span class="material-symbols-rounded">stars</span>
                <span>Constellation</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-200 opacity-0 data-[open=true]:opacity-100">
              <a class="mobile-menu-item" role="menuitem" href={studioHref}>
                <span class="material-symbols-rounded">palette</span>
                <span>Studio</span>
              </a>
            </li>
            <li class="transition-opacity duration-300 delay-225 opacity-0 data-[open=true]:opacity-100">
              <button class="mobile-menu-item w-full text-left" role="menuitem"
                      onclick="document.getElementById('creator-toggle')?.click?.()">
                <span class="material-symbols-rounded">auto_awesome</span>
                <span>Maker</span>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>


<style>
  /* Apple liquid glass navbar with M3 expressive design - now using .glass-liquid from global.css */

  /* M3 expressive chip with proper styling */
  .chip-m3 {
    background: var(--md-sys-color-primary, #7150D9);
    color: var(--md-sys-color-on-primary, #fff);
    border: 0;
    border-radius: 999px;
    padding: .45rem .8rem;
    box-shadow: var(--md-sys-elevation-1, 0 6px 20px rgba(0,0,0,.06));
    cursor: pointer;
    font-weight: 650;
    white-space: nowrap;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 0 1 auto;
    transition: transform var(--md-sys-motion-duration-short, 200ms) var(--md-sys-motion-ease-standard, ease-out),
                box-shadow var(--md-sys-motion-duration-short, 200ms) var(--md-sys-motion-ease-standard, ease-out);
  }

  .chip-m3:hover {
    box-shadow: var(--md-sys-elevation-2, 0 12px 28px rgba(0,0,0,.08));
    transform: translateY(-1px);
  }

  /* Brand styling */
  .brand {
    letter-spacing: .2px;
    color: var(--ariane-text-ink, var(--ink));
    text-decoration: none !important;
  }

  .brand:hover,
  .brand:focus,
  .brand:focus-visible {
    text-decoration: none !important;
  }

  /* Nav link styling - original neat appearance */
  .nav-link {
    color: var(--ariane-text-ink, var(--ink));
    text-decoration: none !important;
    font-weight: 600;
    white-space: nowrap;
    padding: 4px 8px;
    border-radius: 10px;
    transition: background 0.2s ease, color 0.2s ease;
    font-size: inherit;
    line-height: 1.15;
  }

  .nav-link:hover,
  .nav-link:focus,
  .nav-link:visited,
  .nav-link:active {
    background: var(--ariane-hover-wash, rgba(255,255,255,.15));
    color: var(--ariane-text-ink-dim, rgba(0,0,0,.8));
    text-decoration: none !important;
  }


  /* Mobile menu items (card-style) */
  .mobile-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    margin: 0.25rem 0.5rem;
    border-radius: 12px;
    color: var(--ariane-body-text);
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: var(--body);
    line-height: 1.2;
  }

  .mobile-menu-item:hover,
  .mobile-menu-item:focus {
    background: var(--ariane-hover-wash, rgba(255,255,255,.15));
    color: var(--ariane-text-ink-dim);
    text-decoration: none;
    transform: translateY(-1px);
  }

  .mobile-menu-item .material-symbols-rounded {
    color: var(--ariane-text-ink);
    font-size: 20px;
  }

  /* Compact state for narrow screens */
  .chip-m3.compact .label {
    display: none;
  }
  .chip-m3.compact {
    padding: .45rem .6rem;
  }

  /* Responsive label hiding */
  @media (max-width: 500px) {
    .chip-m3 .label {
      display: none;
    }
    .chip-m3 {
      padding: .45rem .6rem;
    }
  }
</style>

<script type="module" is:inline>
  const qs = (s) => document.querySelector(s);

  // Darkens the glass as you scroll down
  const onScroll = () => {
    if (window.scrollY > 24) {
      document.documentElement.classList.add('scrolled');
    } else {
      document.documentElement.classList.remove('scrolled');
    }
  };
  addEventListener('scroll', onScroll, { passive: true });
  onScroll();

  // Creator toggle functionality (desktop)
  const creatorToggle = qs('#creator-toggle');
  creatorToggle?.addEventListener('click', () => {
    const html = document.documentElement;
    const open = html.getAttribute('data-creator') === 'open';
    html.setAttribute('data-creator', open ? 'closed' : 'open');
    creatorToggle.setAttribute('aria-expanded', String(!open));
    window.dispatchEvent(new CustomEvent('toggle-creator', { detail: { open: !open } }));
  });

  // M3 Expressive Mobile Menu
  const exploreBtn = qs('#explore-toggle');
  const mobileMenuWrap = qs('#mobile-menu');
  const mobileMenuPanel = mobileMenuWrap?.querySelector('[data-anim]');
  const menuItems = mobileMenuWrap?.querySelectorAll('li');

  // ensure menu items get their data-open on first open
  let itemsPrimed = false;
  function setItemsOpen(open) {
    if (!menuItems) return;
    if (!itemsPrimed) {
      menuItems.forEach(li => li.setAttribute('data-open', 'false'));
      itemsPrimed = true;
    }
    menuItems.forEach(li => li.setAttribute('data-open', open ? 'true' : 'false'));
  }

  function openMobileMenu(open) {
    if (!exploreBtn || !mobileMenuWrap || !mobileMenuPanel) return;

    exploreBtn.setAttribute('aria-expanded', String(open));

    if (open) {
      mobileMenuWrap.hidden = false;
      // ENTER (M3 expressive): overshooty, longer duration
      mobileMenuPanel.style.transitionTimingFunction = 'cubic-bezier(0.2, 1.2, 0.35, 1)';
      mobileMenuPanel.style.transitionDuration = '420ms';
      requestAnimationFrame(() => {
        mobileMenuPanel.classList.remove('-translate-y-4', 'scale-[0.97]');
        mobileMenuPanel.classList.add('translate-y-0', 'scale-100');
        setItemsOpen(true);
      });
    } else {
      // EXIT: snappier, no overshoot
      mobileMenuPanel.style.transitionTimingFunction = 'cubic-bezier(0.3, 0, 0.8, 0.15)';
      mobileMenuPanel.style.transitionDuration = '280ms';
      mobileMenuPanel.classList.add('-translate-y-4', 'scale-[0.97]');
      mobileMenuPanel.classList.remove('translate-y-0', 'scale-100');
      setItemsOpen(false);
      mobileMenuPanel.addEventListener('transitionend', () => (mobileMenuWrap.hidden = true), { once: true });
    }
  }

  // Mobile menu event listeners
  exploreBtn?.addEventListener('click', () => {
    const isOpen = exploreBtn.getAttribute('aria-expanded') === 'true';
    openMobileMenu(!isOpen);
  });

  // Click outside / Esc to close
  document.addEventListener('click', (e) => {
    if (!mobileMenuWrap?.hidden &&
        !mobileMenuWrap.contains(e.target) &&
        e.target !== exploreBtn &&
        !exploreBtn?.contains(e.target)) {
      openMobileMenu(false);
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      openMobileMenu(false);
    }
  });

  // Close mobile menu when clicking a link
  mobileMenuWrap?.addEventListener('click', (e) => {
    if (e.target.tagName === 'A') {
      openMobileMenu(false);
    }
  });

  // Close mobile menu on resize to avoid stuck state
  addEventListener('resize', () => {
    if (window.innerWidth >= 1024) openMobileMenu(false);
  }, { passive: true });
</script>
